#!/usr/bin/env bash
set -euo pipefail

# Wrapper script for TF-IDF vs Lucene comparison via Docker

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "${SCRIPT_DIR}/.." && pwd)"

# Check Docker availability
if ! command -v docker >/dev/null 2>&1; then
    echo "Error: Docker is required. Please install Docker." >&2
    exit 1
fi

# Parse arguments
COMPARE_ARGS=""

while [[ $# -gt 0 ]]; do
    case $1 in
        --queries-file)
            COMPARE_ARGS="$COMPARE_ARGS --queries-file /opt/app/$2"
            shift 2
            ;;
        --output)
            COMPARE_ARGS="$COMPARE_ARGS --output /opt/app/$2"
            shift 2
            ;;
        *)
            COMPARE_ARGS="$COMPARE_ARGS $1"
            shift
            ;;
    esac
done

echo "========================================"
echo "Index Comparison: TF-IDF vs Lucene"
echo "========================================"
echo "Queries: queries.txt"
echo "TF-IDF: workspace/store/index"
echo "Lucene: workspace/store/lucene_index"
echo "Output: reports/index_comparison.md"
echo "========================================"

# Run via Docker Compose
cd "${PROJECT_ROOT}"
docker compose run --rm \
    -e COMPARE_ARGS="${COMPARE_ARGS}" \
    lucene-compare

echo "========================================"
echo "Comparison complete"
echo "========================================"
